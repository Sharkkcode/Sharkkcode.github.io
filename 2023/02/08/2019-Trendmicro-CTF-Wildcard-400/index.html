<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>2019 Trendmicro CTF Wildcard 400 | BLOG</title><meta name="keywords" content="CTF"><meta name="author" content="Sharkkcode"><meta name="copyright" content="Sharkkcode"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2019 Trendmicro CTF Wildcard 400 這篇文章是我練習 2019 Trendmicro CTF Wildcard 400 這個題目時紀錄的解題筆記，我把一些參考資源放在文章最後面。  Permise ( 前情提要 )​You are a network security administrator for the medium sized business XYZcor">
<meta property="og:type" content="article">
<meta property="og:title" content="2019 Trendmicro CTF Wildcard 400">
<meta property="og:url" content="https://sharkkcode.github.io/2023/02/08/2019-Trendmicro-CTF-Wildcard-400/index.html">
<meta property="og:site_name" content="BLOG">
<meta property="og:description" content="2019 Trendmicro CTF Wildcard 400 這篇文章是我練習 2019 Trendmicro CTF Wildcard 400 這個題目時紀錄的解題筆記，我把一些參考資源放在文章最後面。  Permise ( 前情提要 )​You are a network security administrator for the medium sized business XYZcor">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sharkkcode.github.io/img/wall.jpg">
<meta property="article:published_time" content="2023-02-08T15:12:07.000Z">
<meta property="article:modified_time" content="2023-02-08T15:23:14.605Z">
<meta property="article:author" content="Sharkkcode">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sharkkcode.github.io/img/wall.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://sharkkcode.github.io/2023/02/08/2019-Trendmicro-CTF-Wildcard-400/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2019 Trendmicro CTF Wildcard 400',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-08 23:23:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2445008510937449" crossorigin="anonymous"></script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/catcat.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="https://sharkkcode.github.io/2022/07/08/About-Sharkkcode/"><span> About</span></a></div><div class="menus_item"><a class="site-page" href="https://sharkkcode.github.io/2022/09/14/Portfolio/"><span> Portfolio</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/wall.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">BLOG</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="https://sharkkcode.github.io/2022/07/08/About-Sharkkcode/"><span> About</span></a></div><div class="menus_item"><a class="site-page" href="https://sharkkcode.github.io/2022/09/14/Portfolio/"><span> Portfolio</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2019 Trendmicro CTF Wildcard 400</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-02-08T15:12:07.000Z" title="Created 2023-02-08 23:12:07">2023-02-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-02-08T15:23:14.605Z" title="Updated 2023-02-08 23:23:14">2023-02-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Information-Security/">Information Security</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2019 Trendmicro CTF Wildcard 400"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="2019-Trendmicro-CTF-Wildcard-400"><a href="#2019-Trendmicro-CTF-Wildcard-400" class="headerlink" title="2019 Trendmicro CTF Wildcard 400"></a>2019 Trendmicro CTF Wildcard 400</h1><blockquote>
<p>這篇文章是我練習 2019 Trendmicro CTF Wildcard 400 這個題目時紀錄的解題筆記，我把一些參考資源放在文章最後面。</p>
</blockquote>
<h2 id="Permise-前情提要"><a href="#Permise-前情提要" class="headerlink" title="Permise ( 前情提要 )"></a>Permise ( 前情提要 )</h2><p>​You are a network security administrator for the medium sized business XYZcorp. You often use network flow data to uncover anomalous security events. This challenge provides some sample aggregated data on flows, and uses answers from the anomalous ( 反常的 ) events to construct the flag.</p>
<p>Knowledge of network security or protocols is not required. This challenge requires data stacking, slicing, and&#x2F;or anomaly detection.</p>
<h2 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h2><ul>
<li><p>Timestamp, src, dst, port, bytes.</p>
</li>
<li><p>Internal hosts have IPs beginning with 12~14.</p>
</li>
<li><p>External IPs include everything else.</p>
</li>
</ul>
<h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><hr>
<h3 id="Question-1-Discover-Data-Exfiltration-1"><a href="#Question-1-Discover-Data-Exfiltration-1" class="headerlink" title="Question 1: Discover Data Exfiltration 1"></a>Question 1: Discover Data Exfiltration 1</h3><p>Our intellectual property is leaving the building in large chunks. A machine inside is being used to send out all of our widget designs. One host is sending out much more data from the enterprise than the others. What is its IP?</p>
<hr>
<ul>
<li><p>根據題目我們可以知道我們要找到送出 <strong>大量資料</strong> 的 IP 。</p>
</li>
<li><p>不過在開始對資料進行搜尋之前，我們可以先把資料做一些預處理，方便我們後續的操作。</p>
</li>
<li><p>先 import 一些可能會用到的套件：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> gc</span><br></pre></td></tr></table></figure>
</li>
<li><p>匯入所要分析的檔案先大致查看一下檔案：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">&#x27;/kaggle/input/2019-trendmicro-ctf-wildcard-400/gowiththeflow_20190826.csv&#x27;</span>)</span><br><span class="line">df.info()</span><br><span class="line">df.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 105747729 entries, 0 to 105747728</span><br><span class="line">Data columns (total 5 columns):</span><br><span class="line">#   Column         Dtype </span><br><span class="line">---  ------         ----- </span><br><span class="line">0   1578326400001  int64 </span><br><span class="line">1   13.43.52.51    object</span><br><span class="line">2   18.70.112.62   object</span><br><span class="line">3   40             int64 </span><br><span class="line">4   57354          int64 </span><br><span class="line">dtypes: int64(3), object(2)</span><br><span class="line">memory usage: 3.9+ GB</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd1.png"></p>
<ul>
<li>可以看到第一行是數據，我們可以把它改成欄位資訊，這樣可以方便我們之後對資料的相關操作。</li>
</ul>
</li>
<li><p>再次匯入檔案，並且插入欄位資料：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(</span><br><span class="line">    <span class="string">&#x27;/kaggle/input/2019-trendmicro-ctf-wildcard-400/gowiththeflow_20190826.csv&#x27;</span>,</span><br><span class="line">    header = <span class="literal">None</span>,</span><br><span class="line">    <span class="comment"># Timestamp, Source, Destination, Port, Bytes</span></span><br><span class="line">    names= [<span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;bytes&#x27;</span>]</span><br><span class="line">)</span><br><span class="line">df.info()</span><br><span class="line">df.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 105747730 entries, 0 to 105747729</span><br><span class="line">Data columns (total 5 columns):</span><br><span class="line">#   Column     Dtype </span><br><span class="line">---  ------     ----- </span><br><span class="line">0   timestamp  int64 </span><br><span class="line">1   src        object</span><br><span class="line">2   dst        object</span><br><span class="line">3   port       int64 </span><br><span class="line">4   bytes      int64 </span><br><span class="line">dtypes: int64(3), object(2)</span><br><span class="line">memory usage: 3.9+ GB</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd2.png"></p>
</li>
<li><p>定義一個過濾 IP 的 function 、修改一些欄位的 type 並且增加了 <code>src_int</code> 和 <code>dst_int</code> 這兩個欄位： </p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_internal</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s.<span class="built_in">str</span>.startswith((<span class="string">&#x27;12.&#x27;</span>, <span class="string">&#x27;13.&#x27;</span>, <span class="string">&#x27;14.&#x27;</span>)) </span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;src_int&#x27;</span>] = is_internal(df[<span class="string">&#x27;src&#x27;</span>])</span><br><span class="line">df[<span class="string">&#x27;dst_int&#x27;</span>] = is_internal(df[<span class="string">&#x27;dst&#x27;</span>])</span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;timestamp&#x27;</span>] = pd.to_datetime(df.timestamp, unit=<span class="string">&#x27;ms&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;hour&#x27;</span>]      = df.timestamp.dt.hour.astype(<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;minute&#x27;</span>]    = df.timestamp.dt.minute.astype(<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;port&#x27;</span>]      = df[<span class="string">&#x27;port&#x27;</span>].astype(<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">df.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd3.png"></p>
<ul>
<li><p><code>is_internal</code> 這個 function 過濾了由 12, 13, 14 開頭的 IP ，因為題目 Data 說明有說 12~14 開頭的 IP 是 internal IP 。</p>
</li>
<li><p>新增 <code>src_int</code> 來記錄該 row 的 <code>src</code> 欄位值是否為 internal IP 。</p>
</li>
<li><p>新增 <code>dst_int</code> 來記錄該 row 的 <code>dst</code> 欄位值是否為 internal IP 。</p>
</li>
</ul>
</li>
<li><p>把 IP 相關的資料類型轉成 category ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">all_ips = <span class="built_in">set</span>(df[<span class="string">&#x27;src&#x27;</span>].unique()) | <span class="built_in">set</span>(df[<span class="string">&#x27;dst&#x27;</span>].unique())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Unique src:&#x27;</span>, df[<span class="string">&#x27;src&#x27;</span>].nunique())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Unique dst:&#x27;</span>, df[<span class="string">&#x27;dst&#x27;</span>].nunique())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Total Unique IPs:&#x27;</span>, <span class="built_in">len</span>(all_ips))</span><br><span class="line"></span><br><span class="line">ip_type = pd.CategoricalDtype(categories=all_ips)</span><br><span class="line">df[<span class="string">&#x27;src&#x27;</span>] = df[<span class="string">&#x27;src&#x27;</span>].astype(ip_type)</span><br><span class="line">df[<span class="string">&#x27;dst&#x27;</span>] = df[<span class="string">&#x27;dst&#x27;</span>].astype(ip_type)</span><br><span class="line"></span><br><span class="line">df.info()</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Unique src: 6171</span><br><span class="line">Unique dst: 6005</span><br><span class="line">Total Unique IPs: 6177</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 105747730 entries, 0 to 105747729</span><br><span class="line">Data columns (total 9 columns):</span><br><span class="line">#   Column     Dtype         </span><br><span class="line">---  ------     -----         </span><br><span class="line">0   timestamp  datetime64[ns]</span><br><span class="line">1   src        category      </span><br><span class="line">2   dst        category      </span><br><span class="line">3   port       uint8         </span><br><span class="line">4   bytes      int64         </span><br><span class="line">5   src_int    bool          </span><br><span class="line">6   dst_int    bool          </span><br><span class="line">7   hour       uint8         </span><br><span class="line">8   minute     uint8         </span><br><span class="line">dtypes: bool(2), category(2), datetime64[ns](1), int64(1), uint8(3)</span><br><span class="line">memory usage: 2.5 GB</span><br></pre></td></tr></table></figure>

<ul>
<li><p>這邊解釋一下程式細節：</p>
<ul>
<li><p>找出總共出現過幾種 IP ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_ips = <span class="built_in">set</span>(df[<span class="string">&#x27;src&#x27;</span>].unique()) | <span class="built_in">set</span>(df[<span class="string">&#x27;dst&#x27;</span>].unique())</span><br></pre></td></tr></table></figure>
</li>
<li><p>轉換資料類型：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip_type = pd.CategoricalDtype(categories=all_ips)</span><br><span class="line">df[<span class="string">&#x27;src&#x27;</span>] = df[<span class="string">&#x27;src&#x27;</span>].astype(ip_type)</span><br><span class="line">df[<span class="string">&#x27;dst&#x27;</span>] = df[<span class="string">&#x27;dst&#x27;</span>].astype(ip_type)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>到這邊預處理的動作也做得差不多了可以開始實作題目了，這邊先創建兩個 list 一個是拿來存答案的，一個是拿來記錄我們所找到的可疑 IP ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips = []</span><br><span class="line">answers = []</span><br></pre></td></tr></table></figure>
</li>
<li><p>回顧一下 Question 1 我們要找到送出 <strong>大量資料</strong> 的 IP 。</p>
</li>
<li><p>查找出可疑 IP ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">src_bytes_out = df[df[<span class="string">&#x27;src_int&#x27;</span>] &amp; ~df[<span class="string">&#x27;dst_int&#x27;</span>]]\</span><br><span class="line">    .groupby(<span class="string">&#x27;src&#x27;</span>)\</span><br><span class="line">    .<span class="built_in">bytes</span>.<span class="built_in">sum</span>()\</span><br><span class="line">    .sort_values(ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(src_bytes_out))</span><br><span class="line"><span class="built_in">print</span>(src_bytes_out.to_frame().head(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">src_bytes_out.head(<span class="number">10</span>)\</span><br><span class="line">    .sort_values()\</span><br><span class="line">    .plot.barh(title=<span class="string">&#x27;Outbound Traffic&#x27;</span>)\</span><br><span class="line">    .set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#x27;pandas.core.series.Series&#x27;&gt;</span><br><span class="line">                    bytes</span><br><span class="line">src                      </span><br><span class="line">13.37.84.125  10625497574</span><br><span class="line">13.48.72.30    1727525696</span><br><span class="line">14.51.75.107   1656207638</span><br><span class="line">14.51.30.86    1647330708</span><br><span class="line">12.59.25.34    1617316039</span><br><span class="line">12.56.32.111   1600604429</span><br><span class="line">14.57.50.29    1589314261</span><br><span class="line">13.39.46.94    1576854685</span><br><span class="line">12.58.68.102   1545945975</span><br><span class="line">12.45.94.34    1501437235</span><br><span class="line">Text(0.5, 0, &#x27;Outbound Bytes&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd4.png"></p>
<ul>
<li><p>這邊我利用了 <code>df[&#39;src_int&#39;] &amp; ~df[&#39;dst_int&#39;]</code> 這個 Boolean Series 來過濾出由內到外的流量。</p>
</li>
<li><p>用 <code>.groupby(&#39;src&#39;)</code> 把資料以 <code>src</code> 統整起來，並且再用 <code>.bytes.sum()</code> 把相同 <code>src</code> 的 <code>bytes</code> 欄位的值加總。</p>
</li>
<li><p><code>.sort_values(ascending=False)</code> 表示我要由大到小排序資料。</p>
</li>
<li><p><code>to_frame</code> 可以把 series 類型，轉成 dataframe 類型。</p>
</li>
<li><p>而我們可以根據分析結果知道可疑的 IP 應該就是 <code>13.37.84.125</code> ，因為送出了大量的資料，相異於大部分的 IP 。</p>
</li>
</ul>
</li>
<li><p>以頻率圖來視覺化分析結果：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ax = src_bytes_out\</span><br><span class="line">    .plot.hist(bins=<span class="number">50</span>, title=<span class="string">&#x27;Outbound Traffic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br><span class="line">ax.axvline(src_bytes_out.iloc[<span class="number">0</span>], linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">plt.text(src_bytes_out.iloc[<span class="number">0</span>], <span class="number">1000</span>, <span class="string">&#x27;13.37.84.125&#x27;</span>, rotation=<span class="number">90</span>, horizontalalignment=<span class="string">&#x27;right&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text(10625497574, 1000, &#x27;13.37.84.125&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd5.png"></p>
<ul>
<li><p>這邊可以看出大致上每個 Host ( IP ) 的 <strong>正常外流流量</strong> 的大小照理說應該是多大，我以頻率為 y 軸，這樣就把圖拉長成 2D 圖方便觀察：</p>
<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd6.png"></p>
</li>
<li><p>標記 <code>13.37.84.125</code> ，可以明顯看到該 IP 異常， <code>plt.text</code> 裡的前 2 個值就是在設定字串 <code>13.37.84.125</code> 要放置的座標位置：</p>
<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd7.png"></p>
</li>
<li><p>不過這邊注意到一個問題，左邊有一個很長的 bar ，應該代表記錄了許多傳輸出 0 byte 的資訊，我們可以把這些資訊過濾掉。</p>
</li>
</ul>
</li>
<li><p>過濾掉 0 byte 的數據並重新畫圖：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">src_bytes_out_2 = df[df[<span class="string">&#x27;src_int&#x27;</span>] &amp; ~df[<span class="string">&#x27;dst_int&#x27;</span>]]\</span><br><span class="line">    .groupby(<span class="string">&#x27;src&#x27;</span>)\</span><br><span class="line">    .<span class="built_in">bytes</span>.<span class="built_in">sum</span>()\</span><br><span class="line">    .pipe(<span class="keyword">lambda</span> x : x[x &gt; <span class="number">0</span>])\</span><br><span class="line">    .sort_values(ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(src_bytes_out_2.to_frame().head(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">ax = src_bytes_out_2\</span><br><span class="line">.plot.hist(bins=<span class="number">50</span>, title=<span class="string">&#x27;Outbound Traffic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br><span class="line">ax.axvline(src_bytes_out_2.iloc[<span class="number">0</span>], linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">plt.text(src_bytes_out_2.iloc[<span class="number">0</span>], <span class="number">75</span>, <span class="string">&#x27;13.37.84.125&#x27;</span>, rotation=<span class="number">90</span>, horizontalalignment=<span class="string">&#x27;right&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">                    bytes</span><br><span class="line">src                      </span><br><span class="line">13.37.84.125  10625497574</span><br><span class="line">13.48.72.30    1727525696</span><br><span class="line">14.51.75.107   1656207638</span><br><span class="line">14.51.30.86    1647330708</span><br><span class="line">12.59.25.34    1617316039</span><br><span class="line">12.56.32.111   1600604429</span><br><span class="line">14.57.50.29    1589314261</span><br><span class="line">13.39.46.94    1576854685</span><br><span class="line">12.58.68.102   1545945975</span><br><span class="line">12.45.94.34    1501437235</span><br><span class="line">Text(10625497574, 75, &#x27;13.37.84.125&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd8.png"></p>
<ul>
<li><p>這段程式碼中我加上了 <code>.pipe(lambda x : x[x &gt; 0])</code> 用來過濾加總後的 byte 小於等於 0 的數據，輸入參數為 x series ， <code>x[x &gt; 0])</code> 代表對 x series 進行過濾篩選，篩選條件是 x series 內元素的值大於 0 者。</p>
</li>
<li><p>過濾篩選過後跑出來的圖應該就更可以清楚觀察流量頻率了。</p>
</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;13.37.84.125&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;13.37.84.125&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-2-Discover-Data-Exfiltration-2"><a href="#Question-2-Discover-Data-Exfiltration-2" class="headerlink" title="Question 2: Discover Data Exfiltration 2"></a>Question 2: Discover Data Exfiltration 2</h3><p>Another attacker has a job scheduled that export the contents of our internal wiki. One host is sending out much more data during off hours from the enterprise than the others, different from the host in the Question 1. What is its IP?</p>
<hr>
<ul>
<li><p>根據題目可以知道這次我們要找的就是在 <strong>off hours</strong> 送出 <strong>大量資料</strong> 的 IP 。</p>
</li>
<li><p>視覺化，觀察 24 小時中 <strong>傳輸次數</strong> 統計：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(<span class="string">&#x27;hour&#x27;</span>).size()\</span><br><span class="line">    .plot.bar(title=<span class="string">&#x27;Hour-Connect&#x27;</span>)\</span><br><span class="line">    .set_ylabel(<span class="string">&#x27;Connection Count&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text(0, 0.5, &#x27;Connection Count&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd9.png"></p>
<ul>
<li><p>圖中可以猜測：</p>
<ul>
<li><p>16:00~23:59 是上班時段。</p>
</li>
<li><p>00:00~15:59 是下班時段 ( off hours ) 。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>查找出可疑 IP ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">off_hours_activity = df[</span><br><span class="line">    ~df[<span class="string">&#x27;src&#x27;</span>].isin(blacklist_ips)</span><br><span class="line">    &amp; df[<span class="string">&#x27;src_int&#x27;</span>] &amp; ~df[<span class="string">&#x27;dst_int&#x27;</span>]</span><br><span class="line">    &amp; (df[<span class="string">&#x27;hour&#x27;</span>] &gt;= <span class="number">0</span>) &amp; (df[<span class="string">&#x27;hour&#x27;</span>] &lt; <span class="number">16</span>)</span><br><span class="line">].groupby(<span class="string">&#x27;src&#x27;</span>)\</span><br><span class="line">    .<span class="built_in">bytes</span>.<span class="built_in">sum</span>()\</span><br><span class="line">    .pipe(<span class="keyword">lambda</span> x : x[x &gt; <span class="number">0</span>])\</span><br><span class="line">    .sort_values(ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(off_hours_activity.head(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">off_hours_activity.head(<span class="number">10</span>)\</span><br><span class="line">    .sort_values()\</span><br><span class="line">    .plot.barh(title=<span class="string">&#x27;Outbound Traffic&#x27;</span>)\</span><br><span class="line">    .set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">12.55.77.96     289566918</span><br><span class="line">13.48.72.30     120862595</span><br><span class="line">14.51.30.86     116752466</span><br><span class="line">12.59.25.34     115533918</span><br><span class="line">14.51.75.107    112816919</span><br><span class="line">12.56.32.111    111708846</span><br><span class="line">12.58.68.102    108870195</span><br><span class="line">14.57.50.29     108788348</span><br><span class="line">13.39.46.94     107736632</span><br><span class="line">12.45.94.34     106931217</span><br><span class="line">Name: bytes, dtype: int64</span><br><span class="line">Text(0.5, 0, &#x27;Outbound Bytes&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd10.png"></p>
<ul>
<li><p>語法與之前類似。</p>
</li>
<li><p>圖中可以看到可疑的 IP 應該是 <code>12.55.77.96</code> 。</p>
</li>
</ul>
</li>
<li><p>以頻率圖來視覺化分析結果：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ax = off_hours_activity.plot.hist(bins=<span class="number">50</span>, title=<span class="string">&#x27;Outbound Traffic&#x27;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br><span class="line">ax.axvline(off_hours_activity.iloc[<span class="number">0</span>], linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">plt.text(off_hours_activity.iloc[<span class="number">0</span>], <span class="number">30</span>, <span class="string">&#x27;12.55.77.96&#x27;</span>, rotation=<span class="number">90</span>, horizontalalignment=<span class="string">&#x27;right&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text(289566918, 30, &#x27;12.55.77.96&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd11.png"></p>
</li>
<li><p>結合 Question 1 的結果，並且用所有的時段的 Outbound Traffic 來做比較：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ax = src_bytes_out_2\</span><br><span class="line">    .plot.hist(bins=<span class="number">50</span>, title=<span class="string">&#x27;Outbound Traffic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br><span class="line">ax.axvline(src_bytes_out_2.iloc[<span class="number">0</span>], linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(plt.text(src_bytes_out_2.iloc[<span class="number">0</span>], <span class="number">75</span>, <span class="string">&#x27;13.37.84.125&#x27;</span>, rotation=<span class="number">90</span>, horizontalalignment=<span class="string">&#x27;right&#x27;</span>))</span><br><span class="line">ax.axvline(src_bytes_out_2.loc[<span class="string">&#x27;12.55.77.96&#x27;</span>], color=<span class="string">&#x27;orange&#x27;</span>, linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(plt.text(src_bytes_out_2.loc[<span class="string">&#x27;12.55.77.96&#x27;</span>], <span class="number">75</span>, <span class="string">&#x27;12.55.77.96&#x27;</span>, rotation=<span class="number">90</span>, horizontalalignment=<span class="string">&#x27;right&#x27;</span>))</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Text(10625497574, 75, &#x27;13.37.84.125&#x27;)</span><br><span class="line">Text(1033651932, 75, &#x27;12.55.77.96&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd12.png"></p>
<ul>
<li>透過這樣的呈現方式，我們可以知道如果沒有加上 off hours 的條件，是不太可能透過流量直接找到 <code>12.55.77.96</code> 的！因為它的流量統計在我們認定的 <strong>正常流量範圍</strong> ，且從頻率也無法看出異常。</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;12.55.77.96&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;12.55.77.96&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-3-Discover-Data-Exfiltration-3"><a href="#Question-3-Discover-Data-Exfiltration-3" class="headerlink" title="Question 3: Discover Data Exfiltration 3"></a>Question 3: Discover Data Exfiltration 3</h3><p>Some assailant is grabbing all the employee and vendor email addresses, and sending them out on a channel normally reserved for other uses. This is similar to attackers abusing DNS for data exfiltration. One host is sending out much more data on a some port from the enterprise than other hosts do, different from the hosts in Questions 1 and 2. What is its port?</p>
<hr>
<ul>
<li><p>根據題目可以知道這次我們的目標是找到某個 Host ( IP ) 上的某個異常 port ，且相較於其他 IP 的相同 port ，我們的目標送出了 <strong>大量資料</strong> 。注意到這邊的比較對象是 <strong>其他 IP 的相同 port</strong> ！</p>
</li>
<li><p>一開始我們不太能直接查出是哪個 IP 有問題，因為關鍵的分析點在 port ( 題目是說 port 傳輸資料異常 ) 。如果我們先把有問題的 port 找出來，再推斷 IP 應該是哪個整體來說或許會比較好處理。</p>
</li>
<li><p>每個 port 的流量狀態都不太一樣，該如何找出 <strong>最異常</strong> 的 port ？我的想法是先觀察每個 port 的流量狀態分部圖，然後決定要用甚麼方式去衡量每個圖的 <strong>異常部分</strong> 並給定一個 <strong>可以與其他圖比較的值</strong> ，從這些比較值中取出最突出者，該圖的代表的 port 或許就是我們的目標。</p>
</li>
<li><p>觀察 port 流量：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">src_port_bytes_df = df[</span><br><span class="line">    ~df[<span class="string">&#x27;src&#x27;</span>].isin(blacklist_ips)</span><br><span class="line">    &amp; df[<span class="string">&#x27;src_int&#x27;</span>] &amp; ~df[<span class="string">&#x27;dst_int&#x27;</span>]</span><br><span class="line">].groupby([<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;port&#x27;</span>])\</span><br><span class="line">    .<span class="built_in">bytes</span>.<span class="built_in">sum</span>()\</span><br><span class="line">    .pipe(<span class="keyword">lambda</span> x : x[x &gt; <span class="number">0</span>])\</span><br><span class="line">    .reset_index()</span><br><span class="line"></span><br><span class="line">ports = src_port_bytes_df[<span class="string">&#x27;port&#x27;</span>].unique()</span><br><span class="line"><span class="built_in">print</span>(ports, <span class="string">&quot;Total:&quot;</span>, <span class="built_in">len</span>(ports))</span><br><span class="line"><span class="built_in">print</span>(src_port_bytes_df.head(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">src_port_bytes_df.groupby(<span class="string">&#x27;port&#x27;</span>)\</span><br><span class="line">    .<span class="built_in">bytes</span>.<span class="built_in">sum</span>()\</span><br><span class="line">    .sort_values(ascending=<span class="literal">False</span>)\</span><br><span class="line">    .plot.bar(figsize=(<span class="number">16</span>,<span class="number">4</span>), rot=<span class="number">0</span>, title=<span class="string">&quot;Outbound Traffic&quot;</span>)\</span><br><span class="line">    .set_ylabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[ 22  23  25  26  27  29  34  37  39  40  42  44  50  52  55  56  57  61</span><br><span class="line">65  68  72  74  75  77  79  80  81  82  89  90  92  94  96 102 105 106</span><br><span class="line">112 114 115 117 118 119 121 123 124  51] Total: 46</span><br><span class="line">        src  port     bytes</span><br><span class="line">0  14.56.49.69    22    448629</span><br><span class="line">1  14.56.49.69    23    479361</span><br><span class="line">2  14.56.49.69    25     10080</span><br><span class="line">3  14.56.49.69    26    464350</span><br><span class="line">4  14.56.49.69    27    453729</span><br><span class="line">5  14.56.49.69    29  15548680</span><br><span class="line">6  14.56.49.69    34    464676</span><br><span class="line">7  14.56.49.69    37  15817450</span><br><span class="line">8  14.56.49.69    39  17388933</span><br><span class="line">9  14.56.49.69    40  15583867</span><br><span class="line">Text(0, 0.5, &#x27;Outbound Bytes&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd13.png"></p>
<ul>
<li><p>這邊先是把有 outbound traffic 的 source IP 以及其對應的 port 查尋出來。</p>
</li>
<li><p>接著印出 port 與其對應流量的圖，這張圖說明了有很多 port 都有很高的流量，可見不能單看總流量來判定是哪個 port 有問題。</p>
</li>
<li><p>之後要做的便是仔細觀察每個 port 的流量分部圖，找到可以衡量流量異常的方法！</p>
</li>
</ul>
</li>
<li><p>觀察 port 流量細節，流量分部圖：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fig, axs = plt.subplots(ncols=<span class="number">3</span>, nrows=<span class="number">3</span>, sharey=<span class="literal">True</span>, figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(src_port_bytes_df.port.head(<span class="number">9</span>)):</span><br><span class="line">    src_port_bytes_df[src_port_bytes_df.port == p]\</span><br><span class="line">        .<span class="built_in">bytes</span>.plot.hist(title=<span class="string">&#x27;Port &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p), ax = axs[idx % <span class="number">3</span>][idx // <span class="number">3</span>])\</span><br><span class="line">        .set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    plt.tight_layout()</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd14.png"></p>
<ul>
<li>圖中列出部分 port 的流量分部圖，可以看到流量大致呈現鐘型分部，如果所有的 port 的流量分部都是呈現鐘型分部，那麼 z-score 會是一個不錯的衡量標準，我們可以找出哪個 port 的極端值是距離該圖最多個標準差的，也就是 z-score 最高者，該 port 或許就是我們的目標 port ！</li>
</ul>
</li>
<li><p>z-score 結果：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">src_port_bytes_df\</span><br><span class="line">    .groupby(<span class="string">&#x27;port&#x27;</span>)\</span><br><span class="line">    .apply(<span class="keyword">lambda</span> x: np.<span class="built_in">max</span>((x.<span class="built_in">bytes</span> - x.<span class="built_in">bytes</span>.mean()) / x.<span class="built_in">bytes</span>.std()))\</span><br><span class="line">    .sort_values()\</span><br><span class="line">    .tail(<span class="number">10</span>)\</span><br><span class="line">    .plot.barh(title=<span class="string">&#x27;Score&#x27;</span>)\</span><br><span class="line">    .set_xlabel(<span class="string">&#x27;z-score&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text(0.5, 0, &#x27;z-score&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd15.png"></p>
<ul>
<li><p>這邊補充一下： <code>.apply()</code> 與 <code>.pipe()</code> 不同的地方是 <code>.apply()</code> 會套用到物件中每個元素，而 <code>.pipe()</code> 則是直接套用整個物件。</p>
</li>
<li><p>圖中可以很明顯看到 124 應該就是可疑的 port ，只要去查尋哪個 IP 影響這個 port 最多，就可以順便找到可疑的 IP 。</p>
</li>
</ul>
</li>
<li><p>查尋 IP ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src_124 = src_port_bytes_df\</span><br><span class="line">    .pipe(<span class="keyword">lambda</span> x: x[x[<span class="string">&#x27;port&#x27;</span>] == <span class="number">124</span>])\</span><br><span class="line">    .sort_values(<span class="string">&#x27;bytes&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(src_124.head(<span class="number">10</span>))</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">                src  port   bytes</span><br><span class="line">40972   12.30.96.87   124  356207</span><br><span class="line">15352   13.48.72.30   124   51282</span><br><span class="line">27466  14.51.75.107   124   47964</span><br><span class="line">33592   14.51.30.86   124   47712</span><br><span class="line">7066    13.39.46.94   124   47628</span><br><span class="line">6301    12.59.25.34   124   46032</span><br><span class="line">7246   12.58.68.102   124   45024</span><br><span class="line">43357  12.56.32.111   124   44772</span><br><span class="line">16792   14.36.60.74   124   44730</span><br><span class="line">42772   14.57.50.29   124   44436</span><br></pre></td></tr></table></figure>

<ul>
<li>這邊可以看到 <code>12.30.96.87</code> 應該就是可疑的 IP 。</li>
</ul>
</li>
<li><p>Port 124 的 Outbound Traffic 頻率圖：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ax = src_port_bytes_df[src_port_bytes_df.port == <span class="number">124</span>]\</span><br><span class="line">    .<span class="built_in">bytes</span>.plot.hist(bins=<span class="number">50</span>, title=<span class="string">&#x27;Port 124&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;Outbound Bytes&#x27;</span>)</span><br><span class="line">ax.axvline(src_124.iloc[<span class="number">0</span>, <span class="number">2</span>], linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">plt.text(src_124.iloc[<span class="number">0</span>, <span class="number">2</span>], <span class="number">75</span>, <span class="string">&#x27;12.30.96.87&#x27;</span>, rotation=<span class="number">90</span>, horizontalalignment=<span class="string">&#x27;right&#x27;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text(356207, 75, &#x27;12.30.96.87&#x27;)</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/Sharkkcode/Sharkkcode.github.io/main/img/trendctf2019/dd16.png"></p>
<ul>
<li>補充一下： <code>[0, 2]</code> 語法應該是第 0 個元素的第 2 個元素，所以 <code>src_124.iloc[0, 2]</code> 也就是 356207 。</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;12.30.96.87&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;124&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-4-Private-C-amp-C-channel"><a href="#Question-4-Private-C-amp-C-channel" class="headerlink" title="Question 4: Private C&amp;C channel"></a>Question 4: Private C&amp;C channel</h3><p>We’re always running a low-grade infection; some internal machines will always have some sort of malware. Some of these infected hosts phone home to C&amp;C on a private channel. What unique port is used by external malware C&amp;C to marshal its bots?</p>
<hr>
<ul>
<li><p>根據題意，我們的目標是找到被攻擊方利用的特別的 port 。</p>
</li>
<li><p>透過搜尋異常流量的方式不一定管用，因為攻擊方的目的應該是下達一些指令，控制他的 bots ，流量可能不會很明顯。</p>
</li>
<li><p>可以做一個猜測，那就是那個用來做壞事的特別的 port 可能只有攻擊方在使用，那這樣我們便可以透過尋找每個 port 的 <strong>使用人數</strong> 來篩選出可疑的 port 。</p>
</li>
<li><p>統計 port 的使用人數，也可以說是被幾個相異的 IP 使用：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df[~df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>]]\</span><br><span class="line">    .drop_duplicates((<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;port&#x27;</span>))\</span><br><span class="line">    .groupby(<span class="string">&#x27;port&#x27;</span>).size()\</span><br><span class="line">    .sort_values()\</span><br><span class="line">    .head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">port</span><br><span class="line">113       1</span><br><span class="line">90     4898</span><br><span class="line">124    4903</span><br><span class="line">42     4903</span><br><span class="line">123    4904</span><br><span class="line">117    4905</span><br><span class="line">112    4911</span><br><span class="line">25     4919</span><br><span class="line">106    4922</span><br><span class="line">72     4945</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>

<ul>
<li>這邊可以看到 port 113 使用人數極少，只有 1 人，故 113 應該就是可疑的 port 。</li>
</ul>
</li>
<li><p>繼續追查 IP ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df[~df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>] &amp; (df[<span class="string">&#x27;port&#x27;</span>] == <span class="number">113</span>)][[<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;port&#x27;</span>]])</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">                    src            dst  port</span><br><span class="line">521103     15.104.76.58   12.45.104.32   113</span><br><span class="line">8455408    15.104.76.58  12.54.109.102   113</span><br><span class="line">10094540   15.104.76.58   12.44.90.114   113</span><br><span class="line">14443402   15.104.76.58    13.46.43.95   113</span><br><span class="line">16983638   15.104.76.58   14.41.54.105   113</span><br><span class="line">20206698   15.104.76.58    14.40.73.39   113</span><br><span class="line">22688530   15.104.76.58    13.34.88.95   113</span><br><span class="line">23883205   15.104.76.58   13.43.104.74   113</span><br><span class="line">28087393   15.104.76.58    12.33.73.55   113</span><br><span class="line">29337719   15.104.76.58    13.34.89.21   113</span><br><span class="line">29697525   15.104.76.58    13.30.55.77   113</span><br><span class="line">31434981   15.104.76.58    13.44.73.37   113</span><br><span class="line">32387869   15.104.76.58   13.52.101.31   113</span><br><span class="line">37953699   15.104.76.58   14.30.32.122   113</span><br><span class="line">39415621   15.104.76.58    13.39.45.30   113</span><br><span class="line">64825734   15.104.76.58   14.43.103.75   113</span><br><span class="line">65976771   15.104.76.58   13.56.119.33   113</span><br><span class="line">66955446   15.104.76.58   13.51.24.117   113</span><br><span class="line">94996259   15.104.76.58   14.50.119.33   113</span><br><span class="line">95777941   15.104.76.58   13.34.68.110   113</span><br><span class="line">98494120   15.104.76.58    12.41.62.22   113</span><br><span class="line">100484752  15.104.76.58   14.41.120.94   113</span><br><span class="line">103642547  15.104.76.58    14.47.74.88   113</span><br></pre></td></tr></table></figure>

<ul>
<li>這邊可以觀察出 <code>15.104.76.58</code> 應該就是可疑的 IP 。</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;15.104.76.58&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;113&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-5-Internal-P2P"><a href="#Question-5-Internal-P2P" class="headerlink" title="Question 5: Internal P2P"></a>Question 5: Internal P2P</h3><p>Sometimes our low-grade infection is visible in other ways. One particular virus has spread through a number of machines, which now are used to relay commands to each other. The malware has created an internal P2P network. What unique port is used by the largest internal clique, of all hosts talking to each other?</p>
<hr>
<ul>
<li><p>根據題意，我們的目標是要找到 Internal Host ( IP ) 裡面的 P2P Network ，題目又有提示到這個 Internal Host 連線圖裡最大的一個 clique ，而且這個 clique 裡面的 Host 應該都是用同一個 port 在溝通。</p>
</li>
<li><p>Clique 相關說明：</p>
<ul>
<li><p>Clique :</p>
<ul>
<li><p>完全子圖。</p>
</li>
<li><p>任兩點都有連邊的一個子圖。</p>
</li>
</ul>
</li>
<li><p>Maximal Clique :</p>
<ul>
<li><p>極大完全子圖。</p>
</li>
<li><p>不存在更大 Clique 包含的 Clique 。</p>
</li>
</ul>
</li>
<li><p>Maximum Clique :</p>
<ul>
<li><p>最大完全子圖。</p>
</li>
<li><p>最大的 Maximal Clique 。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>定義 Internal Host 連線所形成的圖的 edge ，並且列出所有可能會使用的 port ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">internal_edges_all = df[</span><br><span class="line">    df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>]</span><br><span class="line">].drop_duplicates([<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;port&#x27;</span>])</span><br><span class="line"></span><br><span class="line">internal_ports = internal_edges_all.port.unique()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(internal_edges_all)</span><br><span class="line"><span class="built_in">print</span>(internal_ports)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">                        timestamp           src           dst  port  bytes  \</span><br><span class="line">9         2020-01-06 16:00:00.021  14.32.60.107  12.30.62.113    72   1036   </span><br><span class="line">15        2020-01-06 16:00:00.025  14.49.89.121   12.42.30.44   114   2462   </span><br><span class="line">18        2020-01-06 16:00:00.035   14.32.69.91   13.58.72.67    57  36215   </span><br><span class="line">30        2020-01-06 16:00:00.048  12.48.32.126  12.56.47.110    80   1018   </span><br><span class="line">33        2020-01-06 16:00:00.052  13.37.55.112   13.57.76.27    92  15941   </span><br><span class="line">...                           ...           ...           ...   ...    ...   </span><br><span class="line">105696553 2020-01-11 16:00:00.998   12.33.69.54   12.47.47.34   121    784   </span><br><span class="line">105696663 2020-01-11 16:00:53.777  12.49.123.62   13.50.37.48    22    763   </span><br><span class="line">105701686 2020-01-11 16:42:35.956   12.48.81.33   13.37.51.62    83    961   </span><br><span class="line">105707383 2020-01-11 17:29:51.463   13.34.23.71  14.39.88.102    83   1052   </span><br><span class="line">105708928 2020-01-11 17:42:43.896  14.54.110.71   13.47.22.97    83   1227   </span><br><span class="line"></span><br><span class="line">        src_int  dst_int  hour  minute  </span><br><span class="line">9             True     True    16       0  </span><br><span class="line">15            True     True    16       0  </span><br><span class="line">18            True     True    16       0  </span><br><span class="line">30            True     True    16       0  </span><br><span class="line">33            True     True    16       0  </span><br><span class="line">...            ...      ...   ...     ...  </span><br><span class="line">105696553     True     True    16       0  </span><br><span class="line">105696663     True     True    16       0  </span><br><span class="line">105701686     True     True    16      42  </span><br><span class="line">105707383     True     True    17      29  </span><br><span class="line">105708928     True     True    17      42  </span><br><span class="line"></span><br><span class="line">[7469743 rows x 9 columns]</span><br><span class="line">[ 72 114  57  80  92  56  27  79  82  89  39  81 123  52 118 115 102  75</span><br><span class="line">105  65 106 119  23  37 121 117  26  96  61  90 112  25  22  74  77  50</span><br><span class="line">68  34  55  29  42  44  40  94 124  83]</span><br></pre></td></tr></table></figure>

<ul>
<li>以 <code>[&#39;src&#39;, &#39;dst&#39;, &#39;port&#39;]</code> 來定義 IP 連線圖的邊 ( edge ) ，接著抓出可能使用的 port 。</li>
</ul>
</li>
<li><p>現在我們有 IP 連線圖了，接著可以根據 port 來找出用哪個 port 所連接起來的 Clique 是最大的，也就是說要針對每個 port 找出 Maximum Clique ，再來比較哪個 port 的 Maximum Clique 是最大的。</p>
</li>
<li><p>在計算每個 port 的 Maximum Clique 之前，我們可以做一些前置動作來加快之後 Maximal Clique 的尋找。先把 <strong>可能的最大 Clique</strong> 算出來。</p>
</li>
<li><p>計算每個 port 可能的最大 Clique ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">port_upper_bounds = []</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> internal_ports:</span><br><span class="line">    internal_edges = internal_edges_all\</span><br><span class="line">        .pipe(<span class="keyword">lambda</span> x: x[x[<span class="string">&#x27;port&#x27;</span>] == p])       </span><br><span class="line"></span><br><span class="line">    edges = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> l, r <span class="keyword">in</span> <span class="built_in">zip</span>(internal_edges.src, internal_edges.dst):</span><br><span class="line">        <span class="keyword">if</span> l == r:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        k = <span class="built_in">min</span>((l, r), (r, l))</span><br><span class="line">        edges.add(k)</span><br><span class="line">    </span><br><span class="line">    degrees = Counter()</span><br><span class="line">    <span class="keyword">for</span> (l, r) <span class="keyword">in</span> edges:</span><br><span class="line">        degrees[l] += <span class="number">1</span></span><br><span class="line">        degrees[r] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    max_clique_size = <span class="number">0</span></span><br><span class="line">    min_degrees = <span class="built_in">len</span>(degrees)</span><br><span class="line">    <span class="keyword">for</span> idx, (node, degree) <span class="keyword">in</span> <span class="built_in">enumerate</span>(degrees.most_common()):</span><br><span class="line">      </span><br><span class="line">        min_degrees = <span class="built_in">min</span>(min_degrees, degree)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> min_degrees &gt;= idx:</span><br><span class="line">            max_clique_size = <span class="built_in">max</span>(max_clique_size, idx+<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> min_degrees &lt; max_clique_size:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">    port_upper_bounds.append((p, max_clique_size))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;port_upper_bounds:&quot;</span>, port_upper_bounds)</span><br><span class="line">port_upper_bounds.sort(key = <span class="keyword">lambda</span> x: -x[-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(port_upper_bounds[:<span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>(-port_upper_bounds[<span class="number">0</span>][-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">port_upper_bounds: [(72, 202), (114, 203), (57, 202), (80, 202), (92, 202), (56, 202), (27, 202), (79, 202), (82, 202), (89, 203), (39, 202), (81, 202), (123, 201), (52, 202), (118, 203), (115, 203), (102, 203), (75, 203), (105, 202), (65, 203), (106, 201), (119, 202), (23, 202), (37, 202), (121, 202), (117, 201), (26, 202), (96, 202), (61, 202), (90, 201), (112, 201), (25, 201), (22, 202), (74, 202), (77, 202), (50, 202), (68, 202), (34, 202), (55, 203), (29, 203), (42, 201), (44, 203), (40, 203), (94, 202), (124, 200), (83, 263)]</span><br><span class="line">[(83, 263), (114, 203), (89, 203), (118, 203), (115, 203)]</span><br><span class="line">-263</span><br></pre></td></tr></table></figure>

<ul>
<li><p>第 1 層 for loop 內的細節說明：</p>
<ul>
<li><p>篩選出特定 port <code>p</code> ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">internal_edges = internal_edges_all\</span><br><span class="line">    .pipe(<span class="keyword">lambda</span> x: x[x[<span class="string">&#x27;port&#x27;</span>] == p])</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立 edge 且避免重複：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">edges = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> l, r <span class="keyword">in</span> <span class="built_in">zip</span>(internal_edges.src, internal_edges.dst):</span><br><span class="line">        <span class="keyword">if</span> l == r:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        k = <span class="built_in">min</span>((l, r), (r, l))</span><br><span class="line">        edges.add(k)</span><br></pre></td></tr></table></figure>
</li>
<li><p>紀錄 degrees ，也就是紀錄圖中每個 node ( 這邊也就是 IP ) 所連接的 edge 的個數：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">degrees = Counter()</span><br><span class="line">    <span class="keyword">for</span> (l, r) <span class="keyword">in</span> edges:</span><br><span class="line">        degrees[l] += <span class="number">1</span></span><br><span class="line">        degrees[r] += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>len(degrees)</code> 可以想成該圖中 node ( IP ) 數量。</li>
</ul>
</li>
</ul>
</li>
<li><p>第 2 層 for loop 內的細節說明：</p>
<ul>
<li><p>這裡有產生可能的最大的 Clique 的實作邏輯。</p>
</li>
<li><p>每次迴圈都會有 <code>idx, (node, degree)</code> ，而這 3 個是由 <code>enumerate(degrees.most_common())</code> 產生。</p>
</li>
<li><p><code>idx + 1</code> 是 index + 1 但可以想成到目前為止加入了多少個 node ，後面應該會做解釋。</p>
</li>
<li><p><code>node</code> 代表現在正在處理哪個 IP 。</p>
</li>
<li><p><code>degree</code> 該 node ( IP ) 的 degree ， <code>.most_common()</code> 會把 <code>degree</code> 由大到小排列。</p>
</li>
<li><p>程式會一直以目前最小的 <code>degree</code> 來更新 <code>min_degree</code> ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">min_degrees = <span class="built_in">min</span>(min_degrees, degree)</span><br></pre></td></tr></table></figure>
</li>
<li><p>只要 <code>min_degrees &gt;= idx</code> 就會去更新 <code>max_clique_size</code> 的值， <code>idx+1</code> 可以想像成到現在為止，加入了多少 node 到我們的可能的最大 Clique 的猜測中。</p>
</li>
<li><p>如果要假設可能的最大的 Clique 要想說比較小的 <code>degree</code> 的 <code>node</code> 一定會連到比他更大的 <code>degree</code> 的 <code>node</code> 所連結到的地方！這樣一來每過一次迴圈就可以想成又新納入一個 node 到可能的最大的 Clique ，而中止條件就是 <code>min_degrees &lt; idx</code> ( 不能再納入新的 node 因為本身的 degree 已經小於已納入的 node ) 且 <code>min_degrees &lt; max_clique_size</code> 的時候。</p>
</li>
<li><p>為何可以說 <code>min_degrees &lt; idx</code> 就不能再納入新的 node ？這是因為一個 Clique 如果有 <code>K</code> 個 node 那每個 node 的 degree 都會是 <code>&gt;= K-1</code> ，要加入一個新的 node 到 Clique 就必須要符合這個條件。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>把我們算出來的每個 port 的可能的最大的 Clique 代到計算 Maximum Clique 的程式碼中：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> networkx</span><br><span class="line"><span class="keyword">from</span> networkx.algorithms.approximation.clique <span class="keyword">import</span> large_clique_size</span><br><span class="line"></span><br><span class="line">max_port = <span class="number">0</span></span><br><span class="line">curr_max_clique = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> p, max_clique_upper_bound <span class="keyword">in</span> port_upper_bounds:</span><br><span class="line">    <span class="keyword">if</span> curr_max_clique &gt; max_clique_upper_bound:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    internal_edges = internal_edges_all\</span><br><span class="line">        .pipe(<span class="keyword">lambda</span> x: x[x[<span class="string">&#x27;port&#x27;</span>] == p])</span><br><span class="line"></span><br><span class="line">    internal_nodes = <span class="built_in">set</span>(internal_edges.src) | <span class="built_in">set</span>(internal_edges.dst)</span><br><span class="line">    G = networkx.Graph()</span><br><span class="line">    G.add_nodes_from(internal_nodes)</span><br><span class="line">    <span class="keyword">for</span> l, r <span class="keyword">in</span> <span class="built_in">zip</span>(internal_edges.src, internal_edges.dst):</span><br><span class="line">        G.add_edge(l, r)        </span><br><span class="line">        </span><br><span class="line">    lcs_G = large_clique_size(G) </span><br><span class="line">    <span class="keyword">if</span> curr_max_clique &lt; lcs_G:</span><br><span class="line">        curr_max_clique = lcs_G</span><br><span class="line">        max_port = p</span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(max_port, curr_max_clique)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">83 264</span><br></pre></td></tr></table></figure>

<ul>
<li><p>這邊可以看到可疑的 port 應該就是 83 。</p>
</li>
<li><p>這邊 264 這個數值跟我之前計算的 263 不太一樣但基本上接近，目前不確定是哪個環節沒處理好 QQ ，不過以結果來看我還是找到了 83 這個可疑的 port 。</p>
</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">answers.append(<span class="string">&quot;83&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-6-Malware-Controller"><a href="#Question-6-Malware-Controller" class="headerlink" title="Question 6: Malware Controller"></a>Question 6: Malware Controller</h3><p>We were just blacklisted by an IP reputation service, because some host in our network is behaving badly. One host is a bot herder receiving C&amp;C callbacks from its botnet, which has little other reason to communicate with hosts in the enterprise. What is its IP?</p>
<hr>
<ul>
<li><p>這題的目標是在 Internal Host ( IP ) 中找出一個接收大量許多外面的 IP 連線的主機 IP 。</p>
</li>
<li><p>篩選連線：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">single_dst_df = df[~df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>]]\</span><br><span class="line">    .drop_duplicates([<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>])\</span><br><span class="line">    .src.value_counts()\</span><br><span class="line">    .pipe(<span class="keyword">lambda</span> x: x[x == <span class="number">1</span>])\</span><br><span class="line">    .index</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(single_dst_df)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CategoricalIndex([&#x27;17.102.25.55&#x27;, &#x27;16.101.98.39&#x27;, &#x27;19.89.121.63&#x27;,</span><br><span class="line">                &#x27;15.112.29.111&#x27;, &#x27;17.105.23.53&#x27;, &#x27;16.41.92.57&#x27;,</span><br><span class="line">                &#x27;17.40.52.37&#x27;, &#x27;19.57.43.28&#x27;, &#x27;17.114.26.126&#x27;,</span><br><span class="line">                &#x27;17.102.21.125&#x27;,</span><br><span class="line">                ...</span><br><span class="line">                &#x27;15.87.89.27&#x27;, &#x27;18.57.106.67&#x27;, &#x27;16.16.28.29&#x27;, &#x27;19.75.84.23&#x27;,</span><br><span class="line">                &#x27;17.95.61.34&#x27;, &#x27;17.68.79.43&#x27;, &#x27;18.18.75.100&#x27;, &#x27;17.73.89.103&#x27;,</span><br><span class="line">                &#x27;19.110.27.46&#x27;, &#x27;18.115.94.38&#x27;],</span><br><span class="line">                categories=[&#x27;12.58.76.101&#x27;, &#x27;17.101.96.114&#x27;, &#x27;17.88.119.67&#x27;, &#x27;19.94.120.85&#x27;, &#x27;12.49.48.29&#x27;, &#x27;16.40.36.78&#x27;, &#x27;12.48.64.37&#x27;, &#x27;18.26.113.46&#x27;, ...], ordered=False, dtype=&#x27;category&#x27;, length=172)</span><br></pre></td></tr></table></figure>

<ul>
<li>這邊篩選了由外到內且指向 1 個特定 IP 的連線。</li>
</ul>
</li>
<li><p>找出那些連線都連到哪個 Internal Host ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df[~df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>]\</span><br><span class="line">    &amp; df[<span class="string">&#x27;src&#x27;</span>].isin(single_dst_df)]\</span><br><span class="line">    .drop_duplicates([<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>])\</span><br><span class="line">    .groupby(<span class="string">&#x27;dst&#x27;</span>).size()\</span><br><span class="line">    .where(<span class="keyword">lambda</span> x: x &gt; <span class="number">0</span>).dropna()</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dst</span><br><span class="line">14.45.67.46    172.0</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<ul>
<li><code>14.45.67.46</code> 應該就是答案。</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;14.45.67.46&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;14.45.67.46&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-7-Infected-Host"><a href="#Question-7-Infected-Host" class="headerlink" title="Question 7: Infected Host"></a>Question 7: Infected Host</h3><p>One host is part of the botnet from Question 6, what is its IP?</p>
<hr>
<ul>
<li><p>接續 Question 6 ，這題目標是要找到在 Internal Host 中的 botnet 成員。</p>
</li>
<li><p>可以先觀察之前 botnet 的機器是透過什麼 port 來連到 <code>14.45.67.46</code> ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">check_port_df = df[~df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>]\</span><br><span class="line">    &amp; df[<span class="string">&#x27;src&#x27;</span>].isin(single_dst_df)]\</span><br><span class="line">    .drop_duplicates([<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>])\</span><br><span class="line">    .head(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(check_port_df)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">                    timestamp            src          dst  port  bytes  \</span><br><span class="line">14608704 2020-01-06 21:59:50.350  18.50.110.105  14.45.67.46    27    941   </span><br><span class="line">14611627 2020-01-06 21:59:54.799  19.125.42.108  14.45.67.46    27    877   </span><br><span class="line">14612007 2020-01-06 21:59:55.336   19.112.61.90  14.45.67.46    27    931   </span><br><span class="line">14612050 2020-01-06 21:59:55.401   15.67.125.70  14.45.67.46    27   1147   </span><br><span class="line">14612053 2020-01-06 21:59:55.401    19.92.34.40  14.45.67.46    27    913   </span><br><span class="line">14612060 2020-01-06 21:59:55.408   15.62.112.58  14.45.67.46    27    995   </span><br><span class="line">14612456 2020-01-06 21:59:56.015  17.102.21.125  14.45.67.46    27    976   </span><br><span class="line">14613022 2020-01-06 21:59:56.828    16.24.77.68  14.45.67.46    27   1097   </span><br><span class="line">14613146 2020-01-06 21:59:57.004   15.32.22.108  14.45.67.46    27    652   </span><br><span class="line">14613239 2020-01-06 21:59:57.149  17.105.78.122  14.45.67.46    27    966   </span><br><span class="line"></span><br><span class="line">        src_int  dst_int  hour  minute  </span><br><span class="line">14608704    False     True    21      59  </span><br><span class="line">14611627    False     True    21      59  </span><br><span class="line">14612007    False     True    21      59  </span><br><span class="line">14612050    False     True    21      59  </span><br><span class="line">14612053    False     True    21      59  </span><br><span class="line">14612060    False     True    21      59  </span><br><span class="line">14612456    False     True    21      59  </span><br><span class="line">14613022    False     True    21      59  </span><br><span class="line">14613146    False     True    21      59  </span><br><span class="line">14613239    False     True    21      59  </span><br></pre></td></tr></table></figure>

<ul>
<li>可以看到是透過 port 27 來連線。</li>
</ul>
</li>
<li><p>篩選 Internal IP ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bad_host_df = df[</span><br><span class="line">    df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>]</span><br><span class="line">    &amp; (df[<span class="string">&#x27;dst&#x27;</span>] == <span class="string">&#x27;14.45.67.46&#x27;</span>)</span><br><span class="line">    &amp; (df[<span class="string">&#x27;port&#x27;</span>] == <span class="number">27</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bad_host_df)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">                    timestamp          src          dst  port  bytes  \</span><br><span class="line">14623736 2020-01-06 22:00:12.552  14.51.84.50  14.45.67.46    27    902   </span><br><span class="line">56910312 2020-01-08 22:00:00.821  14.51.84.50  14.45.67.46    27    944   </span><br><span class="line">62683180 2020-01-09 08:34:32.855  13.42.70.40  14.45.67.46    27    979   </span><br><span class="line">99230632 2020-01-10 22:00:12.456  14.51.84.50  14.45.67.46    27   1043   </span><br><span class="line"></span><br><span class="line">        src_int  dst_int  hour  minute  </span><br><span class="line">14623736     True     True    22       0  </span><br><span class="line">56910312     True     True    22       0  </span><br><span class="line">62683180     True     True     8      34  </span><br><span class="line">99230632     True     True    22       0  </span><br></pre></td></tr></table></figure>

<ul>
<li>這邊比較可疑的 IP 應該是我選出現比較多次的 <code>14.51.84.50</code> 。</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;14.51.84.50&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;14.51.84.50&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-8-Botnet-Inside"><a href="#Question-8-Botnet-Inside" class="headerlink" title="Question 8: Botnet Inside"></a>Question 8: Botnet Inside</h3><p>There is a stealthier botnet in the network, using low frequency periodic callbacks to external C&amp;C, with embedded higher frequency calls. What port does it use?</p>
<hr>
<ul>
<li><p>這題我直接找最少使用的 port ：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[(df[<span class="string">&#x27;src_int&#x27;</span>] &amp; ~df[<span class="string">&#x27;dst_int&#x27;</span>])]\</span><br><span class="line">    .groupby(<span class="string">&#x27;port&#x27;</span>).size().sort_values().head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">port</span><br><span class="line">51        107</span><br><span class="line">31        348</span><br><span class="line">32       5564</span><br><span class="line">78       5640</span><br><span class="line">21       5671</span><br><span class="line">95       5672</span><br><span class="line">36       5778</span><br><span class="line">123    481275</span><br><span class="line">42     481672</span><br><span class="line">112    481942</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">answers.append(<span class="string">&quot;51&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-9-Lateral-Brute"><a href="#Question-9-Lateral-Brute" class="headerlink" title="Question 9: Lateral Brute"></a>Question 9: Lateral Brute</h3><p>Once a machine is popped, it’s often used to explore what else can be reached. One host is being used to loudly probe the entire enterprise, trying to find ways onto every other host in the enterprise. What is its IP?</p>
<hr>
<ul>
<li><p>這題直接找發起連線次數最多的就好了：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df[df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>]]\</span><br><span class="line">    .drop_duplicates([<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>])\</span><br><span class="line">    .groupby(<span class="string">&#x27;src&#x27;</span>).size()\</span><br><span class="line">    .sort_values(ascending=<span class="literal">False</span>)\</span><br><span class="line">    .head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">13.42.70.40     999</span><br><span class="line">13.37.84.125    417</span><br><span class="line">14.42.99.114    417</span><br><span class="line">14.47.69.45     417</span><br><span class="line">13.39.93.73     417</span><br><span class="line">13.50.37.48     417</span><br><span class="line">13.31.71.38     417</span><br><span class="line">12.56.101.50    417</span><br><span class="line">14.42.109.95    417</span><br><span class="line">14.52.75.82     417</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;13.42.70.40&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;13.42.70.40&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Question-10-Lateral-Spy"><a href="#Question-10-Lateral-Spy" class="headerlink" title="Question 10: Lateral Spy"></a>Question 10: Lateral Spy</h3><p>One host is trying to find a way onto every other host more quietly. What is its IP?</p>
<hr>
<ul>
<li><p>這題要找比較難直接看出找到但是也在掃瞄 Internal Host 的 Internal Host 。</p>
</li>
<li><p>找有只有單一 source 的連線群，統計連線數量看看是否像是在作掃描 IP 的動作：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df[df[<span class="string">&#x27;src_int&#x27;</span>] &amp; df[<span class="string">&#x27;dst_int&#x27;</span>] &amp; ~df[<span class="string">&#x27;src&#x27;</span>].isin(blacklist_ips)]\</span><br><span class="line">    .drop_duplicates([<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;port&#x27;</span>])\</span><br><span class="line">    .groupby([<span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;port&#x27;</span>])\</span><br><span class="line">    .src\</span><br><span class="line">    .apply(<span class="built_in">list</span>)\</span><br><span class="line">    .dropna()\</span><br><span class="line">    .pipe(<span class="keyword">lambda</span> x: x[x.<span class="built_in">map</span>(<span class="built_in">len</span>) == <span class="number">1</span>])\</span><br><span class="line">    .to_frame()\</span><br><span class="line">    .explode(<span class="string">&#x27;src&#x27;</span>)\</span><br><span class="line">    .src.value_counts()</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">12.49.123.62    5097</span><br><span class="line">Name: src, dtype: int64</span><br></pre></td></tr></table></figure>

<ul>
<li>這邊可以看到 <code>12.49.123.62</code> 發起了許多對內的連線，像是在作掃描。</li>
</ul>
</li>
<li><p>把答案記錄下來：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc.collect()</span><br><span class="line">blacklist_ips.append(<span class="string">&#x27;12.49.123.62&#x27;</span>)</span><br><span class="line">answers.append(<span class="string">&#x27;12.49.123.62&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="Final-Check"><a href="#Final-Check" class="headerlink" title="Final Check"></a>Final Check</h3><p>Answer Hash is <code>ec766132cac80b821793fb9e7fdfd763</code> .</p>
<hr>
<ul>
<li><p>我的答案：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(blacklist_ips)</span><br><span class="line"><span class="built_in">print</span>(answers)</span><br></pre></td></tr></table></figure>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;13.37.84.125&#x27;, &#x27;12.55.77.96&#x27;, &#x27;12.30.96.87&#x27;, &#x27;15.104.76.58&#x27;, &#x27;14.45.67.46&#x27;, &#x27;14.51.84.50&#x27;, &#x27;13.42.70.40&#x27;, &#x27;12.49.123.62&#x27;]</span><br><span class="line">[&#x27;13.37.84.125&#x27;, &#x27;12.55.77.96&#x27;, &#x27;124&#x27;, &#x27;113&#x27;, &#x27;83&#x27;, &#x27;14.45.67.46&#x27;, &#x27;14.51.84.50&#x27;, &#x27;51&#x27;, &#x27;13.42.70.40&#x27;, &#x27;12.49.123.62&#x27;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>檢查答案：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">answer_hash = hashlib.md5(<span class="string">&#x27;:&#x27;</span>.join(answers).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"><span class="keyword">if</span> answer_hash == <span class="string">&#x27;ec766132cac80b821793fb9e7fdfd763&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Correct!!!&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Wrong QQ...&quot;</span>)</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Correct!!!</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源"></a>參考資源</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://pberba.github.io/security/2019/10/08/data-exfiltration/">https://pberba.github.io/security/2019/10/08/data-exfiltration/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://pberba.github.io/security/2020/04/26/lateral-movement/">https://pberba.github.io/security/2020/04/26/lateral-movement/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/hawkcurry/data-analysis-for-network-security-101-questions/notebook">https://www.kaggle.com/code/hawkcurry/data-analysis-for-network-security-101-questions/notebook</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/hawkcurry/data-analysis-for-network-security-101-solution/notebook">https://www.kaggle.com/code/hawkcurry/data-analysis-for-network-security-101-solution/notebook</a></p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://sharkkcode.github.io">Sharkkcode</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://sharkkcode.github.io/2023/02/08/2019-Trendmicro-CTF-Wildcard-400/">https://sharkkcode.github.io/2023/02/08/2019-Trendmicro-CTF-Wildcard-400/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/13/obedient-cat/"><img class="prev-cover" src="/img/wall.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">obedient cat</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/05/Heres-a-Libc/"><img class="next-cover" src="/img/wall.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Heres a Libc</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/07/21/CTF-Introduction/" title="CTF Introduction"><img class="cover" src="/img/wall.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-21</div><div class="title">CTF Introduction</div></div></a></div><div><a href="/2022/08/16/SHELL-CTF-2022/" title="SHELL CTF 2022"><img class="cover" src="/img/wall.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-16</div><div class="title">SHELL CTF 2022</div></div></a></div><div><a href="/2022/07/23/pwnable-tw-start/" title="pwnable tw start"><img class="cover" src="/img/wall.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-23</div><div class="title">pwnable tw start</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/catcat.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Sharkkcode</div><div class="author-info__description">Keep Learning</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Sharkkcode"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">THIS IS MY BLOG~~~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2019-Trendmicro-CTF-Wildcard-400"><span class="toc-number">1.</span> <span class="toc-text">2019 Trendmicro CTF Wildcard 400</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Permise-%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81"><span class="toc-number">1.1.</span> <span class="toc-text">Permise ( 前情提要 )</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Data"><span class="toc-number">1.2.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenges"><span class="toc-number">1.3.</span> <span class="toc-text">Challenges</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-1-Discover-Data-Exfiltration-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">Question 1: Discover Data Exfiltration 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-2-Discover-Data-Exfiltration-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">Question 2: Discover Data Exfiltration 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-3-Discover-Data-Exfiltration-3"><span class="toc-number">1.3.3.</span> <span class="toc-text">Question 3: Discover Data Exfiltration 3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-4-Private-C-amp-C-channel"><span class="toc-number">1.3.4.</span> <span class="toc-text">Question 4: Private C&amp;C channel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-5-Internal-P2P"><span class="toc-number">1.3.5.</span> <span class="toc-text">Question 5: Internal P2P</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-6-Malware-Controller"><span class="toc-number">1.3.6.</span> <span class="toc-text">Question 6: Malware Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-7-Infected-Host"><span class="toc-number">1.3.7.</span> <span class="toc-text">Question 7: Infected Host</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-8-Botnet-Inside"><span class="toc-number">1.3.8.</span> <span class="toc-text">Question 8: Botnet Inside</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-9-Lateral-Brute"><span class="toc-number">1.3.9.</span> <span class="toc-text">Question 9: Lateral Brute</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-10-Lateral-Spy"><span class="toc-number">1.3.10.</span> <span class="toc-text">Question 10: Lateral Spy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Final-Check"><span class="toc-number">1.3.11.</span> <span class="toc-text">Final Check</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%BA%90"><span class="toc-number">1.4.</span> <span class="toc-text">參考資源</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/03/Perfect-Secrecy/" title="Perfect Secrecy"><img src="/img/wall.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Perfect Secrecy"/></a><div class="content"><a class="title" href="/2023/03/03/Perfect-Secrecy/" title="Perfect Secrecy">Perfect Secrecy</a><time datetime="2023-03-03T08:30:31.000Z" title="Created 2023-03-03 16:30:31">2023-03-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/19/Over-The-Wire-Bandit-Walkthrough/" title="Over The Wire Bandit Walkthrough"><img src="/img/wall.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Over The Wire Bandit Walkthrough"/></a><div class="content"><a class="title" href="/2023/02/19/Over-The-Wire-Bandit-Walkthrough/" title="Over The Wire Bandit Walkthrough">Over The Wire Bandit Walkthrough</a><time datetime="2023-02-18T17:06:16.000Z" title="Created 2023-02-19 01:06:16">2023-02-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/13/pumbling/" title="pumbling"><img src="/img/wall.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pumbling"/></a><div class="content"><a class="title" href="/2023/02/13/pumbling/" title="pumbling">pumbling</a><time datetime="2023-02-12T16:54:47.000Z" title="Created 2023-02-13 00:54:47">2023-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/13/First-Grep/" title="First Grep"><img src="/img/wall.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="First Grep"/></a><div class="content"><a class="title" href="/2023/02/13/First-Grep/" title="First Grep">First Grep</a><time datetime="2023-02-12T16:51:28.000Z" title="Created 2023-02-13 00:51:28">2023-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/13/whats-a-net-cat/" title="whats a net cat"><img src="/img/wall.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="whats a net cat"/></a><div class="content"><a class="title" href="/2023/02/13/whats-a-net-cat/" title="whats a net cat">whats a net cat</a><time datetime="2023-02-12T16:43:07.000Z" title="Created 2023-02-13 00:43:07">2023-02-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Sharkkcode</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>